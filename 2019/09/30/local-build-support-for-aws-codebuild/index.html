
<!DOCTYPE html>
<html lang="en,default">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Devhaks 개발 저장소">
    <title>[AWS] CodeBuild 로컬 테스트 및 디버깅 - Devhaks 개발 저장소</title>
    <meta name="author" content="이종학">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"이종학","sameAs":["https://github.com/devhaks/"],"image":"https://www.gravatar.com/avatar/dfca80a65a05d05bf0d417a6ca99a57d"},"articleBody":"\n\n\n배경\n\n로컬 환경 구현하기\n\n참고글\n\n\n배경회사 배포 방식을 AWS CodeBuild 로 production 배포 환경을 구현한 상태였습니다. 그러나 가끔 배포가 실패하는데 디버깅을 할 수 있는 환경이 없어서 매번 AWS 콘솔에서 직접 수동으로 테스트 하는것이 번거로웠습니다. \n그래서 로컬에서 AWS CodeBuild 하는 방법을 찾았고 소개하려 합니다. CodeBuild 에 필요한 buildspec.yml 작성 방법을 공부하는 입장에서도 매우 유용할 것입니다. \n테스트는 MacOS 에서 진행하였습니다.\n\n로컬 환경 구현하기로컬 CodeBuild 환경에 대한 이해를 하기 위해 3가지 요소를 설명합니다.\n\n\n\nAWS CodeBuild local agent\n쉽게 말해서 빌드 서버 입니다. 빌드 하는 곳은 모두 빌드 서버라고 할 수 있습니다. AWS 에서는 CodeBuild 라는 서비스로 빌드 서버를 제공합니다.\n\nAWS CodeBuild image\nCodeBuild agent 가 프로젝트를 빌드하기 위해 필요한 이미지입니다.각 프로젝트 개발 환경은 다릅니다. python, nodejs, java 등등 개발 언어 또는 OS 환경에 따라 빌드 환경을 구성해야 합니다. AWS는 여러 빌드 환경을 제공하고 있습니다.\n\nProject code\n빌드할 코드 파일입니다. 저는 예제로 생성한 vue.js 기본 템플릿을 빌드 하겠습니다.\n\n\n1) 로컬에 Docker 설치\nDocker를 설치하지 않은 경우, Docker 초급을 참고하세요.\n로컬이 없다면, AWS Cloud9 (Web browser IDE)을 이용하여 docker 설치 없이 다음 단계로 진행 가능합니다.\n\n2) CodeBuild image 빌드하기\n로컬에 다음 저장소를 다운로드 합니다.\n1$ git clone https://github.com/aws/aws-codebuild-docker-images\n\n프로젝트에 맞는 CodeBuild image 를 생성합니다. \n\n제가 예시로 생성한 vue.js 는 NPM 기반이기 때문에 nodejs 용 빌드 이미지를 생성하겠습니다. \n123456789101112131415161718192021222324252627282930313233343536373839404142434445464748$ cd aws-codebuild-docker-images# aws-codebuild-docker-images/# 지원하는 이미지 목록 입니다. 디렉토리명이 왜 unsupported_images 인지는 잘 모르겠네요.$ ls -l ubuntu/unsupported_images/  total 0  drwxr-xr-x   3 lewis  staff    96B  8  4 22:58 android-java-6  drwxr-xr-x   3 lewis  staff    96B  8  4 22:58 android-java-7  drwxr-xr-x   4 lewis  staff   128B  8  4 22:58 android-java-8  drwxr-xr-x   5 lewis  staff   160B  8  4 22:58 docker  drwxr-xr-x   5 lewis  staff   160B  8  4 22:58 dot-net  drwxr-xr-x   7 lewis  staff   224B  8  4 22:58 golang  drwxr-xr-x   7 lewis  staff   224B  8  4 22:58 java  drwxr-xr-x  10 lewis  staff   320B  8  4 22:58 nodejs  drwxr-xr-x   5 lewis  staff   160B  8  4 22:58 php  drwxr-xr-x   8 lewis  staff   256B  8  4 22:58 python  drwxr-xr-x   7 lewis  staff   224B  8  4 22:58 ruby  drwxr-xr-x   3 lewis  staff    96B  8  4 22:58 ubuntu-base$ cd ubuntu/unsupported_images/nodejs/10.14.1# aws-codebuild-docker-images/ubuntu/unsupported_images/nodejs/10.14.1/$ ls -ltotal 32-rw-r--r--  1 lewis  staff  7325  8  4 22:58 Dockerfile-rwxr-xr-x  1 lewis  staff   439  8  4 22:58 dockerd-entrypoint.sh-rw-r--r--  1 lewis  staff    51  8  4 22:58 ssh_config# build 명령어 도움말 출력하여 빌드를 위한 -t 옵션 설명보기$ docker build --help ...-t, --tag list        Name and optionally a tag in the 'name:tag' format...# codebuild 이미지 생성하기# build -t 옵션 설명대로 name은 'aws/codebuild/nodejs', tag는 '10.14.1' 로 설정합니다.# 마지막 '.' 표시는 기본적으로 Dockerfile 이 존재하는 경로를 의미합니다. # 현재 경로에 Dockerfile 이 있으므로 '.' 로 적습니다.$ docker build -t aws/codebuild/nodejs:10.14.1 .Sending build context to Docker daemon  11.26kB...Successfully built 03c41ff10894Successfully tagged aws/codebuild/nodejs:10.14.1# docker 이미지 목록 출력$ docker imagesREPOSITORY            TAG       IMAGE ID      CREATED       SIZEaws/codebuild/nodejs  10.14.1   03c41ff10894  8 weeks ago   1.34GB\n\n\n\n3) AWS CodeBuild local agent 이미지 다운로드\n이 이미지는 실제 AWS CodeBuild agent 처럼 동일한 환경을 가진 이미지 입니다.\n\naws-codebuild-local 이미지를 다운로드 합니다. \n123456$ docker pull amazon/aws-codebuild-local:latest --disable-content-trust=false...$ docker images # 이미지 목록 출력 REPOSITORY                  TAG       IMAGE ID      CREATED       SIZEamazon/aws-codebuild-local  latest    b0bdf3d66f0e  2 months ago  563MB\n\n\n\n4) project 빌드하기\nvue.js 기본 템플릿을 다운로드 합니다.\n1234$ git clone git@github.com:devhaks/aws.git$ cd aws# 브랜치 변경aws $ git checkout blog/local-build-support-for-aws-codebuild\n\n로컬 빌드를 하기 위해 프로젝트에 codebuild_build.sh 파일을 다운로드 하고 실행 권한을 변경합니다.\n1aws $ chmod +x codebuild_build.sh\n\n프로젝트의 buildspec.yml 살펴보기\n12345678910111213141516171819version: 0.2phases:  install:  # 빌드에 필요한 패키지 설치    commands:      - npm install  # 설치 명령어  pre_build:  # 빌드 전처리: 코드 검사     commands:      - npm run lint  build:  # 빌드 실행    commands:      - npm run build  post_build: # 빌드 후처리    commands:      - rm -rf node_modules .git # 빌드 결과물 용량을 최적화 하기 위한 패키지 및 .git 삭제      - ls -alartifacts:  # 결과물 설정  files:    - '**/*'  # 모든 파일을 결과물로 생성\n\nlocal build 테스트하기\n123# aws/codebuild/nodejs 의 image_id =&gt; 03c41ff10894# 현재 경로의 artifacts 디렉토리에 결과물 저장하도록 설정aws $ ./codebuild_build.sh -i 03c41ff10894 -a ./artifacts\n\n주의할 점은 빌드를 진행하면 프로젝트 내의 모든 파일들을 빌드 컨테이너에 다운로드 합니다. 만약 프로젝트의 패키지가 포함되어 있으면 다운로드 시간이 오래 걸립니다.그러므로 패키지를 삭제 또는 프로젝트 외부에 잠시 옮겨 놓고 빌드 테스트를 진행 하는 것이 빠릅니다.\n\n\n12345678910111213141516171819202122232425Creating network \"agent-resources_default\" with the default driverCreating volume \"agent-resources_source_volume\" with local driverCreating volume \"agent-resources_user_volume\" with local driverCreating agent-resources_agent_1 ... doneCreating agent-resources_build_1 ... done...agent_1  | [Container] 2019/09/30 03:54:28 Phase complete: POST_BUILD State: SUCCEEDEDagent_1  | [Container] 2019/09/30 03:54:28 Phase context status code:  Message: agent_1  | [Container] 2019/09/30 03:54:28 Expanding base directory path: .agent_1  | [Container] 2019/09/30 03:54:28 Assembling file listagent_1  | [Container] 2019/09/30 03:54:28 Expanding .agent_1  | [Container] 2019/09/30 03:54:28 Expanding artifact file paths for base directory .agent_1  | [Container] 2019/09/30 03:54:28 Assembling file listagent_1  | [Container] 2019/09/30 03:54:28 Expanding **/*agent_1  | [Container] 2019/09/30 03:54:28 Found 21071 file(s)agent_1  | [Container] 2019/09/30 03:54:37 Preparing to copy secondary artifactsagent_1  | [Container] 2019/09/30 03:54:37 No secondary artifacts defined in buildspecagent_1  | [Container] 2019/09/30 03:54:37 Phase complete: UPLOAD_ARTIFACTS State: SUCCEEDEDagent_1  | [Container] 2019/09/30 03:54:37 Phase context status code:  Message:agent-resources_build_1 exited with code 0# 빌드 결과 확인aws $ ls -l artifactstotal 71056-rw-r--r--  1 lewis  staff  35887169  9 30 12:54 artifacts.zip\n\n\n\n\n\ncodebuild_build.sh 사용법\n1$ codebuild_build.sh [-i image_name or image_id] [-a artifact_output_directory] [options]\n\n주의할 점은 image_name 에 / 가 포함된 경우 docker hub 의 이미지를 검색하기 때문에 image_id 를 사용합니다. \n\n\n\n\n참고글AWS 공식 문서 - 로컬 빌드 테스트","dateCreated":"2019-09-30T12:00:00+09:00","dateModified":"2019-10-22T00:28:28+09:00","datePublished":"2019-09-30T12:00:00+09:00","description":"이번 글에서는 로컬에서 Docker 로 AWS CodeBuild 환경을 구현하여 로컬에서 테스트 할 수 있는 방법에 대해 소개합니다.","headline":"[AWS] CodeBuild 로컬 테스트 및 디버깅","image":["thumbnail.png","cover.png"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/"},"publisher":{"@type":"Organization","name":"이종학","sameAs":["https://github.com/devhaks/"],"image":"https://www.gravatar.com/avatar/dfca80a65a05d05bf0d417a6ca99a57d","logo":{"@type":"ImageObject","url":"https://www.gravatar.com/avatar/dfca80a65a05d05bf0d417a6ca99a57d"}},"url":"https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/","keywords":"docker, aws, codebuild","thumbnailUrl":"thumbnail.png"}</script>
    
    
    
        
    

    
        <meta property="og:image" content="https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/thumbnail.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/thumbnail.png" />
    
    
    
        <meta property="og:image" content="https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/cover.png"/>
        <meta class="swiftype" name="image" data-type="enum" content="https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/cover.png" />
    
    
    
        <meta property="og:image" content="https://www.gravatar.com/avatar/dfca80a65a05d05bf0d417a6ca99a57d?s=640"/>
    
    
    

    <meta name="description" content="이번 글에서는 로컬에서 Docker 로 AWS CodeBuild 환경을 구현하여 로컬에서 테스트 할 수 있는 방법에 대해 소개합니다.">
<meta name="keywords" content="docker,aws,codebuild">
<meta property="og:type" content="blog">
<meta property="og:title" content="[AWS] CodeBuild 로컬 테스트 및 디버깅">
<meta property="og:url" content="https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/index.html">
<meta property="og:site_name" content="Devhaks 개발 저장소">
<meta property="og:description" content="이번 글에서는 로컬에서 Docker 로 AWS CodeBuild 환경을 구현하여 로컬에서 테스트 할 수 있는 방법에 대해 소개합니다.">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-10-21T15:28:28.516Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[AWS] CodeBuild 로컬 테스트 및 디버깅">
<meta name="twitter:description" content="이번 글에서는 로컬에서 Docker 로 AWS CodeBuild 환경을 구현하여 로컬에서 테스트 할 수 있는 방법에 대해 소개합니다.">


    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-dig2yh02rpgcdxsbsfha8ujj65grwfvm3xbp1gpa6w8uj8k150ymhv97ed5p.min.css">
    <!--STYLES END-->
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-135461398-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-135461398-1');
    </script>


    
</head>

    <body>
        
        <div id="blog">
            <!-- Define author's picture -->


    
        
    

<header id="header" data-behavior="5">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Devhaks 개발 저장소</a>
    </div>

    <div class="progress-container">
        <div class="progress-bar" id="myBar"></div>
    </div>
    


    
        
            <a  class="header-right-picture "
                href="/me">
        
        
            <img class="header-picture" src="https://www.gravatar.com/avatar/dfca80a65a05d05bf0d417a6ca99a57d?s=90" alt="Author&#39;s picture"/>
        
        </a>
    
</header>


<style>
    /* The progress container (grey background) */
    .progress-container {
        width: 100%;
        height: 10px;
        background: #ccc;
        
    }
    /* The progress bar (scroll indicator) */
    .progress-bar {
        height: 10px;
        background: #ff5151;
        width: 0%;
    }
</style>

<script>
    // When the user scrolls the page, execute myFunction 
    window.onscroll = function() {myFunction()};

    function myFunction() {
        var winScroll = document.body.scrollTop || document.documentElement.scrollTop;
        var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        var scrolled = (winScroll / height) * 100;
        document.getElementById("myBar").style.width = scrolled + "%";
    }
</script>
            <!-- Define author's picture -->


    

<nav id="sidebar" data-behavior="5">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="https://www.gravatar.com/avatar/dfca80a65a05d05bf0d417a6ca99a57d?s=110" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">이종학</h4>
                
                    <h5 class="sidebar-profile-bio"><p>author.bio</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-tags"
                            
                            title="Tags"
                        >
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Tags</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link open-algolia-search"
                             href="#search"
                            
                            title="Search"
                        >
                    
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Search</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/me"
                            
                            title="About"
                        >
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">About</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/devhaks/" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
        <div class="post-header-cover
                    text-left
                    post-header-cover--full"
             style="background-image:url('/2019/09/30/local-build-support-for-aws-codebuild/cover.png');"
             data-behavior="5">
            
                <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            [AWS] CodeBuild 로컬 테스트 및 디버깅
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-09-30T12:00:00+09:00">
	
		    Sep 30, 2019
    	
    </time>
    
</div>

    
</div>

            
        </div>

            <div id="main" data-behavior="5"
                 class="hasCover
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    

    <div class="post-content markdown">
        <div class="main-content-wrap">
            <!-- excerpt -->

<ul>
<li><p><a href="#배경">배경</a></p>
</li>
<li><p><a href="#로컬-환경-구현하기">로컬 환경 구현하기</a></p>
</li>
<li><p><a href="#참고글">참고글</a></p>
</li>
</ul>
<h2 id="배경"><a href="#배경" class="headerlink" title="배경"></a>배경</h2><p>회사 배포 방식을 AWS CodeBuild 로 production 배포 환경을 구현한 상태였습니다. 그러나 가끔 배포가 실패하는데 디버깅을 할 수 있는 환경이 없어서 매번 AWS 콘솔에서 직접 수동으로 테스트 하는것이 번거로웠습니다. </p>
<p>그래서 로컬에서 AWS CodeBuild 하는 방법을 찾았고 소개하려 합니다. CodeBuild 에 필요한 buildspec.yml 작성 방법을 공부하는 입장에서도 매우 유용할 것입니다. </p>
<div class="alert warning"><p>테스트는 MacOS 에서 진행하였습니다.</p>
</div>
<h2 id="로컬-환경-구현하기"><a href="#로컬-환경-구현하기" class="headerlink" title="로컬 환경 구현하기"></a>로컬 환경 구현하기</h2><p>로컬 CodeBuild 환경에 대한 이해를 하기 위해 3가지 요소를 설명합니다.</p>
<br>

<ul>
<li><p>AWS CodeBuild local agent</p>
<p>쉽게 말해서 빌드 서버 입니다. 빌드 하는 곳은 모두 빌드 서버라고 할 수 있습니다. AWS 에서는 CodeBuild 라는 서비스로 빌드 서버를 제공합니다.</p>
</li>
<li><p>AWS CodeBuild image</p>
<p>CodeBuild agent 가 프로젝트를 빌드하기 위해 필요한 이미지입니다.<br>각 프로젝트 개발 환경은 다릅니다. python, nodejs, java 등등 개발 언어 또는 OS 환경에 따라 빌드 환경을 구성해야 합니다. AWS는 여러 빌드 환경을 제공하고 있습니다.</p>
</li>
<li><p>Project code</p>
<p>빌드할 코드 파일입니다. 저는 예제로 생성한 <a href="https://github.com/devhaks/aws/tree/blog/local-build-support-for-aws-codebuild" target="_blank" rel="noopener">vue.js 기본 템플릿</a>을 빌드 하겠습니다.</p>
</li>
</ul>
<h4 id="1-로컬에-Docker-설치"><a href="#1-로컬에-Docker-설치" class="headerlink" title="1) 로컬에 Docker 설치"></a>1) 로컬에 Docker 설치</h4><ul>
<li>Docker를 설치하지 않은 경우, <a href="https://devhaks.github.io/2019/06/30/docker-1/">Docker 초급</a>을 참고하세요.</li>
<li>로컬이 없다면, <a href="https://aws.amazon.com/ko/cloud9/" target="_blank" rel="noopener">AWS Cloud9</a> (Web browser IDE)을 이용하여 docker 설치 없이 다음 단계로 진행 가능합니다.</li>
</ul>
<h4 id="2-CodeBuild-image-빌드하기"><a href="#2-CodeBuild-image-빌드하기" class="headerlink" title="2) CodeBuild image 빌드하기"></a>2) CodeBuild image 빌드하기</h4><ul>
<li><p>로컬에 다음 저장소를 다운로드 합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/aws/aws-codebuild-docker-images</span><br></pre></td></tr></table></figure>
</li>
<li><p>프로젝트에 맞는 CodeBuild image 를 생성합니다. </p>
</li>
<li><p>제가 예시로 생성한 vue.js 는 NPM 기반이기 때문에 nodejs 용 빌드 이미지를 생성하겠습니다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> aws-codebuild-docker-images</span><br><span class="line"></span><br><span class="line"><span class="comment"># aws-codebuild-docker-images/</span></span><br><span class="line"><span class="comment"># 지원하는 이미지 목록 입니다. 디렉토리명이 왜 unsupported_images 인지는 잘 모르겠네요.</span></span><br><span class="line">$ ls -l ubuntu/unsupported_images/</span><br><span class="line">  total 0</span><br><span class="line">  drwxr-xr-x   3 lewis  staff    96B  8  4 22:58 android-java-6</span><br><span class="line">  drwxr-xr-x   3 lewis  staff    96B  8  4 22:58 android-java-7</span><br><span class="line">  drwxr-xr-x   4 lewis  staff   128B  8  4 22:58 android-java-8</span><br><span class="line">  drwxr-xr-x   5 lewis  staff   160B  8  4 22:58 docker</span><br><span class="line">  drwxr-xr-x   5 lewis  staff   160B  8  4 22:58 dot-net</span><br><span class="line">  drwxr-xr-x   7 lewis  staff   224B  8  4 22:58 golang</span><br><span class="line">  drwxr-xr-x   7 lewis  staff   224B  8  4 22:58 java</span><br><span class="line">  drwxr-xr-x  10 lewis  staff   320B  8  4 22:58 nodejs</span><br><span class="line">  drwxr-xr-x   5 lewis  staff   160B  8  4 22:58 php</span><br><span class="line">  drwxr-xr-x   8 lewis  staff   256B  8  4 22:58 python</span><br><span class="line">  drwxr-xr-x   7 lewis  staff   224B  8  4 22:58 ruby</span><br><span class="line">  drwxr-xr-x   3 lewis  staff    96B  8  4 22:58 ubuntu-base</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> ubuntu/unsupported_images/nodejs/10.14.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># aws-codebuild-docker-images/ubuntu/unsupported_images/nodejs/10.14.1/</span></span><br><span class="line">$ ls -l</span><br><span class="line">total 32</span><br><span class="line">-rw-r--r--  1 lewis  staff  7325  8  4 22:58 Dockerfile</span><br><span class="line">-rwxr-xr-x  1 lewis  staff   439  8  4 22:58 dockerd-entrypoint.sh</span><br><span class="line">-rw-r--r--  1 lewis  staff    51  8  4 22:58 ssh_config</span><br><span class="line"></span><br><span class="line"><span class="comment"># build 명령어 도움말 출력하여 빌드를 위한 -t 옵션 설명보기</span></span><br><span class="line">$ docker build --<span class="built_in">help</span> </span><br><span class="line">...</span><br><span class="line">-t, --tag list        Name and optionally a tag <span class="keyword">in</span> the <span class="string">'name:tag'</span> format</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># codebuild 이미지 생성하기</span></span><br><span class="line"><span class="comment"># build -t 옵션 설명대로 name은 'aws/codebuild/nodejs', tag는 '10.14.1' 로 설정합니다.</span></span><br><span class="line"><span class="comment"># 마지막 '.' 표시는 기본적으로 Dockerfile 이 존재하는 경로를 의미합니다. </span></span><br><span class="line"><span class="comment"># 현재 경로에 Dockerfile 이 있으므로 '.' 로 적습니다.</span></span><br><span class="line">$ docker build -t aws/codebuild/nodejs:10.14.1 .</span><br><span class="line">Sending build context to Docker daemon  11.26kB</span><br><span class="line">...</span><br><span class="line">Successfully built 03c41ff10894</span><br><span class="line">Successfully tagged aws/codebuild/nodejs:10.14.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># docker 이미지 목록 출력</span></span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID      CREATED       SIZE</span><br><span class="line">aws/codebuild/nodejs  10.14.1   03c41ff10894  8 weeks ago   1.34GB</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="3-AWS-CodeBuild-local-agent-이미지-다운로드"><a href="#3-AWS-CodeBuild-local-agent-이미지-다운로드" class="headerlink" title="3) AWS CodeBuild local agent 이미지 다운로드"></a>3) AWS CodeBuild local agent 이미지 다운로드</h4><ul>
<li><p>이 이미지는 실제 AWS CodeBuild agent 처럼 동일한 환경을 가진 이미지 입니다.</p>
</li>
<li><p><a href="https://hub.docker.com/r/amazon/aws-codebuild-local" target="_blank" rel="noopener">aws-codebuild-local</a> 이미지를 다운로드 합니다. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ docker pull amazon/aws-codebuild-local:latest --<span class="built_in">disable</span>-content-trust=<span class="literal">false</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$ docker images <span class="comment"># 이미지 목록 출력 </span></span><br><span class="line">REPOSITORY                  TAG       IMAGE ID      CREATED       SIZE</span><br><span class="line">amazon/aws-codebuild-local  latest    b0bdf3d66f0e  2 months ago  563MB</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="4-project-빌드하기"><a href="#4-project-빌드하기" class="headerlink" title="4) project 빌드하기"></a>4) project 빌드하기</h4><ul>
<li><p><a href="https://github.com/devhaks/aws/tree/blog/local-build-support-for-aws-codebuild" target="_blank" rel="noopener">vue.js 기본 템플릿</a>을 다운로드 합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:devhaks/aws.git</span><br><span class="line">$ <span class="built_in">cd</span> aws</span><br><span class="line"><span class="comment"># 브랜치 변경</span></span><br><span class="line">aws $ git checkout blog/<span class="built_in">local</span>-build-support-for-aws-codebuild</span><br></pre></td></tr></table></figure>
</li>
<li><p>로컬 빌드를 하기 위해 프로젝트에 <a href="https://raw.githubusercontent.com/aws/aws-codebuild-docker-images/master/local_builds/codebuild_build.sh" target="_blank" rel="noopener">codebuild_build.sh</a> 파일을 다운로드 하고 실행 권한을 변경합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws $ chmod +x codebuild_build.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>프로젝트의 buildspec.yml 살펴보기</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">0.2</span></span><br><span class="line"></span><br><span class="line"><span class="attr">phases:</span></span><br><span class="line"><span class="attr">  install:</span>  <span class="comment"># 빌드에 필요한 패키지 설치</span></span><br><span class="line"><span class="attr">    commands:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">npm</span> <span class="string">install</span>  <span class="comment"># 설치 명령어</span></span><br><span class="line"><span class="attr">  pre_build:</span>  <span class="comment"># 빌드 전처리: 코드 검사 </span></span><br><span class="line"><span class="attr">    commands:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">lint</span></span><br><span class="line"><span class="attr">  build:</span>  <span class="comment"># 빌드 실행</span></span><br><span class="line"><span class="attr">    commands:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"><span class="attr">  post_build:</span> <span class="comment"># 빌드 후처리</span></span><br><span class="line"><span class="attr">    commands:</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">rm</span> <span class="bullet">-rf</span> <span class="string">node_modules</span> <span class="string">.git</span> <span class="comment"># 빌드 결과물 용량을 최적화 하기 위한 패키지 및 .git 삭제</span></span><br><span class="line"><span class="bullet">      -</span> <span class="string">ls</span> <span class="bullet">-al</span></span><br><span class="line"><span class="attr">artifacts:</span>  <span class="comment"># 결과물 설정</span></span><br><span class="line"><span class="attr">  files:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">'**/*'</span>  <span class="comment"># 모든 파일을 결과물로 생성</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>local build 테스트하기</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># aws/codebuild/nodejs 의 image_id =&gt; 03c41ff10894</span></span><br><span class="line"><span class="comment"># 현재 경로의 artifacts 디렉토리에 결과물 저장하도록 설정</span></span><br><span class="line">aws $ ./codebuild_build.sh -i 03c41ff10894 -a ./artifacts</span><br></pre></td></tr></table></figure>

<div class="alert warning"><p>주의할 점은 빌드를 진행하면 프로젝트 내의 모든 파일들을 빌드 컨테이너에 다운로드 합니다. 만약 프로젝트의 패키지가 포함되어 있으면 다운로드 시간이 오래 걸립니다.<br>그러므로 패키지를 삭제 또는 프로젝트 외부에 잠시 옮겨 놓고 빌드 테스트를 진행 하는 것이 빠릅니다.</p>
</div>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Creating network <span class="string">"agent-resources_default"</span> with the default driver</span><br><span class="line">Creating volume <span class="string">"agent-resources_source_volume"</span> with <span class="built_in">local</span> driver</span><br><span class="line">Creating volume <span class="string">"agent-resources_user_volume"</span> with <span class="built_in">local</span> driver</span><br><span class="line">Creating agent-resources_agent_1 ... <span class="keyword">done</span></span><br><span class="line">Creating agent-resources_build_1 ... <span class="keyword">done</span></span><br><span class="line">...</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Phase complete: POST_BUILD State: SUCCEEDED</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Phase context status code:  Message: </span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Expanding base directory path: .</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Assembling file list</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Expanding .</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Expanding artifact file paths <span class="keyword">for</span> base directory .</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Assembling file list</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Expanding **/*</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:28 Found 21071 file(s)</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:37 Preparing to copy secondary artifacts</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:37 No secondary artifacts defined <span class="keyword">in</span> buildspec</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:37 Phase complete: UPLOAD_ARTIFACTS State: SUCCEEDED</span><br><span class="line">agent_1  | [Container] 2019/09/30 03:54:37 Phase context status code:  Message:</span><br><span class="line">agent-resources_build_1 exited with code 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 빌드 결과 확인</span></span><br><span class="line">aws $ ls -l artifacts</span><br><span class="line">total 71056</span><br><span class="line">-rw-r--r--  1 lewis  staff  35887169  9 30 12:54 artifacts.zip</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>codebuild_build.sh 사용법</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ codebuild_build.sh [-i image_name or image_id] [-a artifact_output_directory] [options]</span><br></pre></td></tr></table></figure>

<div class="alert warning"><p>주의할 점은 <code>image_name</code> 에 <code>/</code> 가 포함된 경우 docker hub 의 이미지를 검색하기 때문에 <code>image_id</code> 를 사용합니다. </p>
</div>

</li>
</ul>
<h2 id="참고글"><a href="#참고글" class="headerlink" title="참고글"></a>참고글</h2><p><a href="https://aws.amazon.com/ko/blogs/devops/announcing-local-build-support-for-aws-codebuild/" target="_blank" rel="noopener">AWS 공식 문서 - 로컬 빌드 테스트</a></p>
            

        </div>
    </div>

    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/aws/">aws</a> <a class="tag tag--primary tag--small t-link" href="/tags/codebuild/">codebuild</a> <a class="tag tag--primary tag--small t-link" href="/tags/docker/">docker</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/11/30/mongodb-model-relationships/" data-tooltip="MongoDB 데이터 관계 모델링" aria-label="PREVIOUS: MongoDB 데이터 관계 모델링">
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="text-small icon-ml">MongoDB 데이터 관계 모델링</span>
                        <!-- <span class="hide-xs hide-sm text-small icon-ml">MongoDB 데이터 관계 모델링</span> -->
                
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/08/25/aws-lambda-image-resizing/" data-tooltip="[AWS] CloudFront Lambda@edge 를 이용한 이미지 리사이징" aria-label="NEXT: [AWS] CloudFront Lambda@edge 를 이용한 이미지 리사이징">
                        <span class="text-small icon-mr">[AWS] CloudFront Lambda@edge 를 이용한 이미지 리사이징</span>
                        <!-- <span class="hide-xs hide-sm text-small icon-mr">[AWS] CloudFront Lambda@edge 를 이용한 이미지 리사이징</span> -->
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <!-- <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li> -->
        
            
            
            <li class="post-action">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <!-- <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top"> -->
            
                <!-- <i class="fa fa-list" aria-hidden="true"></i> -->
            <!-- </a> -->
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://devhaks.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            
            
        
    </div>
</article>


                
<footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 이종학. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="5">
                    <div class="post-bar-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/11/30/mongodb-model-relationships/" data-tooltip="MongoDB 데이터 관계 모델링" aria-label="PREVIOUS: MongoDB 데이터 관계 모델링">
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <span class="hide-xs hide-sm text-small icon-ml">MongoDB 데이터 관계 모델링</span>
                
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/08/25/aws-lambda-image-resizing/" data-tooltip="[AWS] CloudFront Lambda@edge 를 이용한 이미지 리사이징" aria-label="NEXT: [AWS] CloudFront Lambda@edge 를 이용한 이미지 리사이징">
                        <span class="hide-xs hide-sm text-small icon-mr">[AWS] CloudFront Lambda@edge 를 이용한 이미지 리사이징</span>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/" title="Share on Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
    </ul>
</div>


                </div>
                
    <div id="share-options-bar" class="share-options-bar" data-behavior="5">
        <i id="btn-close-shareoptions" class="fa fa-times"></i>
        <ul class="share-options">
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/">
                        <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                    </a>
                </li>
            
                
                
                <li class="share-option">
                    <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/">
                        <i class="fab fa-twitter" aria-hidden="true"></i><span>Share on Twitter</span>
                    </a>
                </li>
            
        </ul>
    </div>


            
        </div>
        


    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="https://www.gravatar.com/avatar/dfca80a65a05d05bf0d417a6ca99a57d?s=110" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">이종학</h4>
        
            <!-- <div id="about-card-bio"><p>author.bio</p>
</div> -->
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Software developer</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-gqfkjfdb6bghizjmdhv1eect2ihkmgoyo6be4xlkou3yljsi2ml5hdwn5chn.min.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'https://devhaks.github.io/2019/09/30/local-build-support-for-aws-codebuild/';
                 
                    this.page.identifier = '2019/09/30/local-build-support-for-aws-codebuild/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'devhaks';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    




        <script src="https://unpkg.com/vanilla-back-to-top@7.2.0/dist/vanilla-back-to-top.min.js"></script>
        <script>
            addBackToTop({
                cornerOffset: 70,
                scrollDuration : 250,
                diameter: 56,
                backgroundColor: 'rgb(255, 82, 82)',
                textColor: '#fff'
            })
        </script> 
    </body>
</html>
